<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seguimiento de Tareas - TaskFlow</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>

<body>
    <header class="header project-header">
        <a href="index.html">
            <img src="logo.png" class="logo-rex" alt="Logo Rex">
        </a>

        <div class="search-bar project-search-bar">
            <i class="fas fa-search"></i>
            <input type="text" placeholder="Buscador en el proyecto...">
        </div>

        <div class="member-interaction-area" id="memberListContainer">
            <img src="miembros.png" class="miembros" alt="Miembros del equipo"><i
                class="fas fa-plus fa-lg mas-miembros"></i>
        </div>

        <div class="project-user-actions">
            <button class="btn primary-btn btn-small" onclick="openInviteMemberModal()">
                Invitar miembro
            </button>
            <a href="proyectoBueno.html" class="btn secondary-btn btn-small">
                Tablero
            </a>
        </div>

        <div class="actions project-user-actions">
            <i class="fas fa-bell notification-icon" style="scale: 1.3; margin-right: 25px;"
                onclick="openNotificationPopover()"></i>
            <a href="#" class="profile-icon" title="Mi Perfil">
                <i class="fas fa-user-circle" style="scale: 3;"></i>
            </a>
        </div>
    </header>

    <main class="main-content tracking-page-content">
        <h1 class="page-title">TAREAS</h1>

        <div class="tasks-table-container">
            <div class="table-header-tracking">
                <div class="table-column-title">Nombre</div>
                <div class="table-column-title">Estado</div>
                <div class="table-column-title">Asignación</div>
            </div>

            <div class="task-item">
                <div class="task-name-col">
                    <span>Bienvenida</span>
                    <i class="fas fa-pencil-alt edit-icon"></i>
                </div>
                <div class="task-status-col">
                    <select class="task-status-select">
                        <option value="pendiente" selected>Pendiente</option>
                        <option value="en-proceso">En Proceso</option>
                        <option value="revision">Revisión</option>
                        <option value="completado">Completado</option>
                    </select>
                </div>
                <div class="task-assignment-col">
                    <select class="task-assignment-select">
                        <option value="">Miembro...</option>
                        <option value="cs">Christian Solís</option>
                        <option value="ja">Mohamed Ali</option>
                    </select>
                </div>
            </div>

            <div class="task-item">
                <div class="task-name-col">
                    <span>Tarea 2</span>
                    <i class="fas fa-pencil-alt edit-icon"></i>
                </div>
                <div class="task-status-col">
                    <select class="task-status-select">
                        <option value="pendiente">...</option>
                        <option value="en-proceso">En Proceso</option>
                        <option value="revision">Revisión</option>
                        <option value="completado">Completado</option>
                    </select>
                </div>
                <div class="task-assignment-col">
                    <select class="task-assignment-select">
                        <option value="" selected>Miembro...</option>
                        <option value="cs">Christian Solís</option>
                        <option value="ja">Mohamed Ali</option>
                    </select>
                </div>
            </div>
            
            <div class="task-item">
                <div class="task-name-col">
                    <span>Tarea 3</span>
                    <i class="fas fa-pencil-alt edit-icon"></i>
                </div>
                <div class="task-status-col">
                    <select class="task-status-select">
                        <option value="pendiente">...</option>
                        <option value="en-proceso">En Proceso</option>
                        <option value="revision">Revisión</option>
                        <option value="completado">Completado</option>
                    </select>
                </div>
                <div class="task-assignment-col">
                    <select class="task-assignment-select">
                        <option value="" selected>Miembro...</option>
                        <option value="cs">Christian Solís</option>
                        <option value="ja">Mohamed Ali</option>
                    </select>
                </div>
            </div>

             <div class="task-item">
                <div class="task-name-col">
                    <span>Tarea 2</span>
                    <i class="fas fa-pencil-alt edit-icon"></i>
                </div>
                <div class="task-status-col">
                    <select class="task-status-select">
                        <option value="pendiente">...</option>
                        <option value="en-proceso">En Proceso</option>
                        <option value="revision">Revisión</option>
                        <option value="completado">Completado</option>
                    </select>
                </div>
                <div class="task-assignment-col">
                    <select class="task-assignment-select">
                        <option value="" selected>Miembro...</option>
                        <option value="cs">Christian Solís</option>
                        <option value="ja">Mohamed Ali</option>
                    </select>
                </div>
            </div>
        </div>
    </main>

    <div id="addItemModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-tasks"></i> Añadir Nueva Tarea</h2>
                <button class="modal-close-btn" onclick="closeAddItemModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p>Formulario para crear o editar una tarea.</p>
            </div>
        </div>
    </div>

    <div id="inviteMemberModal" class="modal-overlay">
        <div class="modal-content small-modal">
            <div class="modal-header">
                <h2><i class="fas fa-user-plus"></i> Invitar Miembro</h2>
                <button class="modal-close-btn" onclick="closeInviteMemberModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label for="invite-email">Invitar por Correo Electrónico</label>
                    <div class="input-with-icon">
                        <i class="fas fa-at"></i>
                        <input type="email" id="invite-email" placeholder="Correo del usuario existente..." required>
                    </div>
                </div>
                <button class="btn primary-btn full-width-btn"
                    onclick="console.log('Invitación enviada a ' + document.getElementById('invite-email').value)">
                    Enviar Invitación
                </button>
                <div class="separator-text">O</div>
                <p style="margin-bottom: 10px; font-weight: 600; font-size: 0.9rem;">Invitar mediante Enlace:</p>
                <div class="invite-link-group">
                    <span id="inviteLink" class="invite-link-text">https://enlace+invitacion...</span>
                    <button class="copy-btn" onclick="copyInviteLink()">
                        <i class="fas fa-copy"></i> Copiar
                    </button>
                </div>
                <p style="font-size: 0.85rem; color: var(--secondary-text); text-align: center;">Comparte este enlace
                    único para que el usuario se una directamente al proyecto.</p>
            </div>
        </div>
    </div>

    <div class="notification-popover" id="notificationPopover">
        <div class="popover-header">
            <h3>Notificaciones</h3>
            <span class="close-popover-btn" onclick="closeNotificationPopover()">&times;</span>
        </div>
        <div class="popover-body">
            <div class="notification-item">
                <span class="member-avatar avatar-cs">CS</span>
                <p class="notification-text">
                    <span class="notification-username">Christian Solís</span> ha creado la columna
                    "Completado".
                </p>
            </div>
            <div class="notification-item">
                <span class="member-avatar avatar-ja">JA</span>
                <p class="notification-text">
                    <span class="notification-username">Juan Andres</span> te ha asignado la tarea
                    "Diseño de wireframes".
                </p>
            </div>
            <div class="notification-item">
                <span class="member-avatar avatar-ma">MA</span>
                <p class="notification-text">
                    <span class="notification-username">Mohamed Ali</span> movió la tarea "Desarrollo" a
                    "En Progreso".
                </p>
            </div>
            <div class="notification-item">
                <span class="member-avatar avatar-jl">JL</span>
                <p class="notification-text">
                    <span class="notification-username">Jessy Lopez</span> comentó en la tarea
                    "Preparación de la demo".
                </p>
            </div
            >
            <a href="#" class="view-all-link">Ver todas las notificaciones</a>
        </div>
    </div>

    <div id="memberListModal" class="modal-overlay">
        <div class="modal-content small-modal">
            <div class="modal-header">
                <h2><i class="fas fa-users"></i> Miembros del Proyecto</h2>
                <button class="modal-close-btn" onclick="closeMemberListModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="member-list-item">
                    <span class="member-avatar avatar-cs">CS</span>
                    <div class="member-info">
                        <div class="member-name">Christian Solís</div>
                        <div class="member-role" id="role-cs">Administrador</div>
                    </div>
                    <div class="member-actions">
                        <button class="role-dropdown-btn" onclick="toggleRoleDropdown('dropdown-cs')">
                            Rol <i class="fas fa-caret-down"></i>
                        </button>
                        <div class="role-dropdown-content" id="dropdown-cs">
                            <a href="#" onclick="selectRole('Christian Solís', 'Administrador', 'role-cs', event)"
                                class="current-role">Administrador</a>
                            <a href="#"
                                onclick="selectRole('Christian Solís', 'Gestor de proyecto', 'role-cs', event)">Gestor
                                de proyecto</a>
                            <a href="#"
                                onclick="selectRole('Christian Solís', 'Trabajador', 'role-cs', event)">Trabajador</a>
                            <a href="#"
                                onclick="selectRole('Christian Solís', 'Colaborador', 'role-cs', event)">Colaborador</a>
                        </div>
                    </div>
                </div>
                <div class="member-list-item">
                    <span class="member-avatar avatar-ja">JA</span>
                    <div class="member-info">
                        <div class="member-name">Juan Andres</div>
                        <div class="member-role" id="role-ja">Colaborador</div>
                    </div>
                    <div class="member-actions">
                        <button class="role-dropdown-btn" onclick="toggleRoleDropdown('dropdown-ja')">
                            Rol <i class="fas fa-caret-down"></i>
                        </button>
                        <div class="role-dropdown-content" id="dropdown-ja">
                            <a href="#"
                                onclick="selectRole('Juan Andres', 'Administrador', 'role-ja', event)">Administrador</a>
                            <a href="#"
                                onclick="selectRole('Juan Andres', 'Gestor de proyecto', 'role-ja', event)">Gestor de
                                proyecto</a>
                            <a href="#"
                                onclick="selectRole('Juan Andres', 'Trabajador', 'role-ja', event)">Trabajador</a>
                            <a href="#" onclick="selectRole('Juan Andres', 'Colaborador', 'role-ja', event)"
                                class="current-role">Colaborador</a>
                        </div>
                    </div>
                </div>
                <div class="member-list-item">
                    <span class="member-avatar avatar-jl">JL</span>
                    <div class="member-info">
                        <div class="member-name">Jessy Lopez</div>
                        <div class="member-role" id="role-jl">Trabajador</div>
                    </div>
                    <div class="member-actions">
                        <button class="role-dropdown-btn" onclick="toggleRoleDropdown('dropdown-jl')">
                            Rol <i class="fas fa-caret-down"></i>
                        </button>
                        <div class="role-dropdown-content" id="dropdown-jl">
                            <a href="#"
                                onclick="selectRole('Jessy Lopez', 'Administrador', 'role-jl', event)">Administrador</a>
                            <a href="#"
                                onclick="selectRole('Jessy Lopez', 'Gestor de proyecto', 'role-jl', event)">Gestor de
                                proyecto</a>
                            <a href="#" onclick="selectRole('Jessy Lopez', 'Trabajador', 'role-jl', event)"
                                class="current-role">Trabajador</a>
                            <a href="#"
                                onclick="selectRole('Jessy Lopez', 'Colaborador', 'role-jl', event)">Colaborador</a>
                        </div>
                    </div>
                </div>
                <div class="member-list-item">
                    <span class="member-avatar avatar-ma">MA</span>
                    <div class="member-info">
                        <div class="member-name">Mohamed Ali</div>
                        <div class="member-role" id="role-ma">Gestor de proyecto</div>
                    </div>
                    <div class="member-actions">
                        <button class="role-dropdown-btn" onclick="toggleRoleDropdown('dropdown-ma')">
                            Rol <i class="fas fa-caret-down"></i>
                        </button>
                        <div class="role-dropdown-content" id="dropdown-ma">
                            <a href="#"
                                onclick="selectRole('Mohamed Ali', 'Administrador', 'role-ma', event)">Administrador</a>
                            <a href="#" onclick="selectRole('Mohamed Ali', 'Gestor de proyecto', 'role-ma', event)"
                                class="current-role">Gestor de proyecto</a>
                            <a href="#"
                                onclick="selectRole('Mohamed Ali', 'Trabajador', 'role-ma', event)">Trabajador</a>
                            <a href="#"
                                onclick="selectRole('Mohamed Ali', 'Colaborador', 'role-ma', event)">Colaborador</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="text-align: right; padding-top: 20px;">
                <button class="btn primary-btn" onclick="openInviteMemberModal(); closeMemberListModal();">
                    Invitar Nuevo Miembro
                </button>
            </div>
        </div>
    </div>

    <script>
        function copyInviteLink() {
            const linkElement = document.getElementById('inviteLink');
            const linkText = linkElement.textContent;

            const textarea = document.createElement('textarea');
            textarea.value = linkText;
            document.body.appendChild(textarea);
            textarea.select();

            try {
                document.execCommand('copy');
                linkElement.textContent = '¡Copiado al portapapeles!';
                setTimeout(() => {
                    linkElement.textContent = linkText;
                }, 2000);
            } catch (err) {
                console.error('No se pudo copiar: ', err);
            } finally {
                document.body.removeChild(textarea);
            }
        }

        const addItemModal = document.getElementById('addItemModal');
        const inviteMemberModal = document.getElementById('inviteMemberModal');
        const trackingModal = document.getElementById('trackingModal');
        const memberListModal = document.getElementById('memberListModal');
        const memberListContainer = document.getElementById('memberListContainer');
        const appContainer = document.querySelector('.app-container'); 
        const notificationPopover = document.getElementById('notificationPopover');


        if (memberListContainer) {
            memberListContainer.addEventListener('click', openMemberListModal);
        }

        let isNotificationPopoverOpen = false;

        function openModal(modal) {
            if (modal !== notificationPopover) {
                closeNotificationPopover(false);
            }
            if (modal) {
                modal.style.display = 'flex';
                if (modal.classList.contains('modal-overlay')) {
                    if (appContainer) {
                        appContainer.classList.add('dimmed-background');
                    }
                }
            }
        }

        function closeModal(modal, restoreDim = true) {
            if (modal) {
                modal.style.display = 'none';
                if (restoreDim && appContainer) {
                    const anyModalOpen = [addItemModal, inviteMemberModal, trackingModal, memberListModal]
                        .some(m => m && m.style.display === 'flex');

                    if (!anyModalOpen) {
                        appContainer.classList.remove('dimmed-background');
                    }
                }
            }
        }

        function openAddItemModal(status) {
            console.log(`Abriendo modal para añadir item en la columna: ${status}`);
            openModal(addItemModal);
        }
        function openInviteMemberModal() {
            openModal(inviteMemberModal);
        }
        function openTrackingModal() {
            openModal(trackingModal);
        }
        function openMemberListModal() {
            console.log("Abriendo modal de Lista de Miembros");
            openModal(memberListModal);
        }
        function openNotificationPopover() {
            if (isNotificationPopoverOpen) {
                closeNotificationPopover();
            } else {
                closeAllRoleDropdowns();
                notificationPopover.style.display = 'flex';
                isNotificationPopoverOpen = true;
            }
        }
        function openAddColumnModal() {
            console.log("Modal de Añadir Columna no implementado aún.");
        }


        function closeAddItemModal() {
            closeModal(addItemModal);
        }
        function closeInviteMemberModal() {
            closeModal(inviteMemberModal);
        }
        function closeTrackingModal() {
            closeModal(trackingModal);
        }
        function closeMemberListModal() {
            closeModal(memberListModal);
        }
        function closeNotificationPopover(restoreDim = true) {
            if (notificationPopover.style.display === 'flex') {
                notificationPopover.style.display = 'none';
                isNotificationPopoverOpen = false;
            }
        }

        function closeAllRoleDropdowns() {
            document.querySelectorAll('.role-dropdown-content.show').forEach(dropdown => {
                dropdown.classList.remove('show');
            });
        }

        function toggleRoleDropdown(dropdownId) {
            const dropdown = document.getElementById(dropdownId);
            document.querySelectorAll('.role-dropdown-content.show').forEach(d => {
                if (d.id !== dropdownId) {
                    d.classList.remove('show');
                }
            });
            dropdown.classList.toggle('show');
        }

        function selectRole(memberName, newRole, roleElementId, event) {
            event.preventDefault();

            const roleElement = document.getElementById(roleElementId);
            roleElement.textContent = newRole;

            const dropdownContent = event.target.closest('.role-dropdown-content');
            dropdownContent.classList.remove('show');

            dropdownContent.querySelectorAll('a').forEach(a => {
                a.classList.remove('current-role');
            });
            event.target.classList.add('current-role');

            console.log(`Rol de ${memberName} actualizado a: ${newRole}`);
        }

        window.onclick = function (event) {
            if (event.target == addItemModal) {
                closeAddItemModal();
            } else if (event.target == inviteMemberModal) {
                closeInviteMemberModal();
            } else if (event.target == trackingModal) {
                closeTrackingModal();
            } else if (event.target == memberListModal) {
                closeMemberListModal();
            }

            const notificationIcon = document.querySelector('.notification-icon');
            const isClickInsidePopover = notificationPopover.contains(event.target);
            const isClickOnIcon = notificationIcon.contains(event.target);

            if (isNotificationPopoverOpen && !isClickInsidePopover && !isClickOnIcon) {
                closeNotificationPopover();
            }

            if (memberListModal.style.display === 'flex') {
                if (!event.target.closest('.member-actions')) {
                    closeAllRoleDropdowns();
                }
            }
        }
    </script>
</body>

</html>